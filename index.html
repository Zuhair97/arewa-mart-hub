<!DOCTYPE html>
<html lang="ha">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arewa-mart Hub | @Bashful97</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfdfd; }
        .arewa-theme { background: linear-gradient(135deg, #065f46 0%, #059669 100%); }
        .glass { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-32">

    <header class="sticky top-0 z-50 glass border-b border-emerald-50 p-5 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 arewa-theme rounded-2xl flex items-center justify-center text-white font-black shadow-lg">AH</div>
            <h1 class="text-sm font-black text-emerald-950 uppercase tracking-tighter">Arewa-mart Hub</h1>
        </div>
        <button onclick="showCart()" class="relative p-2.5 bg-emerald-50 rounded-full">
            üõí <span id="cart-count" class="absolute -top-1 -right-1 bg-emerald-600 text-white text-[9px] px-1.5 py-0.5 rounded-full font-black">0</span>
        </button>
    </header>

    <div id="main-view">
        <div class="flex gap-4 overflow-x-auto px-5 py-6 no-scrollbar" id="cat-list">
            </div>

        <main class="px-4 grid grid-cols-2 gap-4" id="items-grid">
            <p class="col-span-2 text-center py-20 text-gray-400 font-bold animate-pulse text-xs">Ana loda kaya daga Database...</p>
        </main>
    </div>

    <div id="admin-view" class="hidden p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black text-emerald-900">Admin Control</h2>
            <button onclick="showMain()" class="text-[10px] font-black bg-red-50 text-red-500 px-4 py-2 rounded-full">KOMA BAYA</button>
        </div>
        
        <div class="bg-white p-6 rounded-[2.5rem] shadow-2xl border border-emerald-50 mb-10">
            <input id="p-name" placeholder="Sunan Kaya" class="w-full mb-3 p-4 bg-gray-50 rounded-2xl text-sm outline-none border-2 border-transparent focus:border-emerald-500 transition-all">
            <input id="p-price" type="number" placeholder="Farashi (Pi)" class="w-full mb-3 p-4 bg-gray-50 rounded-2xl text-sm outline-none">
            
            <select id="p-cat" class="w-full mb-4 p-4 bg-gray-50 rounded-2xl text-sm outline-none">
                <option value="tech">Lantarki (Tech)</option>
                <option value="fashion">Tufafi (Fashion)</option>
                <option value="agro">Noma (Agro)</option>
                <option value="tailor">Dinki (Tailoring)</option>
            </select>

            <label class="block mb-6 cursor-pointer">
                <div class="w-full border-2 border-dashed border-emerald-200 rounded-2xl p-6 text-center text-gray-400">
                    <span id="file-label" class="text-xs font-bold">Danna don zabo Hoto/Video</span>
                </div>
                <input type="file" id="p-file" accept="image/*,video/*" class="hidden" onchange="updateFileLabel()">
            </label>
            
            <button id="upload-btn" onclick="uploadToFirebase()" class="w-full arewa-theme text-white py-4 rounded-2xl font-black shadow-xl uppercase tracking-widest active:scale-95 transition">ADANA HAR ABADA</button>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 z-[100] hidden bg-black/40 backdrop-blur-md flex items-end">
        <div class="bg-white w-full rounded-t-[3rem] p-8 shadow-2xl">
            <h3 class="text-xl font-black text-emerald-900 mb-6">Kwandon Saye</h3>
            <div id="cart-items" class="space-y-3 mb-8 max-h-60 overflow-y-auto pr-2 no-scrollbar"></div>
            <div class="flex justify-between items-center mb-8 border-t border-emerald-50 pt-6">
                <span class="text-gray-400 font-bold text-xs uppercase">Jimilla</span>
                <span id="cart-total" class="text-2xl font-black text-emerald-800">0 Pi</span>
            </div>
            <button onclick="checkout()" class="w-full arewa-theme text-white py-5 rounded-2xl font-black shadow-xl uppercase mb-3">Tura Oda (Checkout)</button>
            <button onclick="hideCart()" class="w-full text-gray-400 font-bold text-xs uppercase">Rufe</button>
        </div>
    </div>

    <nav class="fixed bottom-6 left-6 right-6 h-20 glass border border-white/50 rounded-[2.5rem] flex justify-around items-center shadow-2xl z-50">
        <button onclick="showMain()" class="text-2xl">üè†</button>
        <button onclick="enterAdmin()" class="text-2xl">‚öôÔ∏è</button>
    </nav>

    <script>
        // 1. FIREBASE CONFIGURATION (Saka naka anan)
        const firebaseConfig = {
            apiKey: "AIzaSy...",
            authDomain: "arewa-mart.firebaseapp.com",
            projectId: "arewa-mart",
            storageBucket: "arewa-mart.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        let cart = [];

        // 2. Load Products from Database
        function loadProducts() {
            db.collection("products").onSnapshot((snapshot) => {
                const grid = document.getElementById('items-grid');
                grid.innerHTML = '';
                snapshot.forEach((doc) => {
                    const p = doc.data();
                    grid.innerHTML += `
                        <div class="bg-white p-3 rounded-[2rem] shadow-sm border border-emerald-50">
                            <img src="${p.url}" class="h-32 w-full object-cover rounded-[1.5rem] mb-3 shadow-sm">
                            <h4 class="text-[10px] font-black text-emerald-950 px-1 uppercase truncate">${p.name}</h4>
                            <p class="text-emerald-600 font-black text-xs mb-3 px-1">${p.price} Pi</p>
                            <button onclick="addToCart('${p.name}', ${p.price})" class="w-full bg-emerald-900 text-white py-2.5 rounded-2xl text-[10px] font-black">+ KWANDO</button>
                        </div>
                    `;
                });
            });
        }

        // 3. Upload to Firebase Storage & Firestore
        async function uploadToFirebase() {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const file = document.getElementById('p-file').files[0];
            const btn = document.getElementById('upload-btn');

            if (!name || !price || !file) return alert("Cike duka bayanan!");

            btn.innerText = "Ana Adanawa...";
            btn.disabled = true;

            const storageRef = storage.ref(`products/${file.name}`);
            await storageRef.put(file);
            const url = await storageRef.getDownloadURL();

            await db.collection("products").add({
                name, price: parseFloat(price), url, category: document.getElementById('p-cat').value, createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            alert("An Adana har abada!");
            btn.innerText = "ADANA HAR ABADA";
            btn.disabled = false;
            showMain();
        }

        // Helper Functions
        function updateFileLabel() { document.getElementById('file-label').innerText = "File ya hau: " + document.getElementById('p-file').files[0].name; }
        function addToCart(name, price) { cart.push({name, price}); document.getElementById('cart-count').innerText = cart.length; }
        function showCart() {
            const modal = document.getElementById('cart-modal');
            const list = document.getElementById('cart-items');
            list.innerHTML = ''; let total = 0;
            cart.forEach(i => { total += i.price; list.innerHTML += `<div class='flex justify-between text-xs font-bold p-3 bg-gray-50 rounded-xl'><span>${i.name}</span><span>${i.price}œÄ</span></div>`; });
            document.getElementById('cart-total').innerText = total + " Pi";
            modal.classList.remove('hidden');
        }
        function hideCart() { document.getElementById('cart-modal').classList.add('hidden'); }
        function showMain() { document.getElementById('main-view').classList.remove('hidden'); document.getElementById('admin-view').classList.add('hidden'); }
        function enterAdmin() { if(prompt("Password:") === "Zuhafs9700") { document.getElementById('main-view').classList.add('hidden'); document.getElementById('admin-view').classList.remove('hidden'); } }

        window.onload = loadProducts;
    </script>
</body>
</html>