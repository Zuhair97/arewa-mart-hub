<!DOCTYPE html>
<html lang="ha">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arewa-mart Hub | @Bashful97</title>
    
    <script src="https://sdk.mine.pi/pi-sdk.js?v=2.0"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .pi-gradient { background: linear-gradient(135deg, #064e3b 0%, #059669 100%); }
        .glass-nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid #e2e8f0; }
        .cat-item { transition: all 0.3s; min-width: 90px; cursor: pointer; border: 2px solid transparent; }
        .cat-item.active { border: 2px solid #059669; background: #ecfdf5; transform: translateY(-2px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="pb-32">

    <header class="sticky top-0 z-50 glass-nav p-4 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-2xl overflow-hidden shadow-md bg-white border border-gray-100 flex items-center justify-center">
                <img src="https://i.postimg.cc/qRqMd44D/unnamed-5-1.jpg" class="w-full h-full object-cover" alt="Logo">
            </div>
            <div>
                <h1 class="text-sm font-black text-emerald-950 uppercase tracking-tighter leading-none">Arewa-mart</h1>
                <p class="text-[9px] font-bold text-emerald-600 uppercase mt-1">Dev: @Bashful97</p>
            </div>
        </div>
        <button onclick="changeLang()" id="lang-btn" class="bg-emerald-900 text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase shadow-sm">ENGLISH</button>
    </header>

    <div id="main-view">
        <div class="flex gap-4 overflow-x-auto p-4 no-scrollbar">
            <div onclick="setTab('all')" id="tab-all" class="cat-item active flex flex-col items-center p-3 rounded-3xl bg-white shadow-sm border">
                <img src="https://cdn-icons-png.flaticon.com/128/263/263142.png" class="w-7 h-7 mb-1">
                <span class="text-[9px] font-bold trans" data-ha="DUKA" data-en="ALL">DUKA</span>
            </div>
            <div onclick="setTab('tech')" id="tab-tech" class="cat-item flex flex-col items-center p-3 rounded-3xl bg-white shadow-sm border">
                <img src="https://cdn-icons-png.flaticon.com/128/644/644458.png" class="w-7 h-7 mb-1">
                <span class="text-[9px] font-bold trans" data-ha="LANTAKRI" data-en="TECH">LANTAKRI</span>
            </div>
            <div onclick="setTab('fashion')" id="tab-fashion" class="cat-item flex flex-col items-center p-3 rounded-3xl bg-white shadow-sm border">
                <img src="https://cdn-icons-png.flaticon.com/128/3050/3050239.png" class="w-7 h-7 mb-1">
                <span class="text-[9px] font-bold trans" data-ha="TUFAFI" data-en="FASHION">TUFAFI</span>
            </div>
            <div onclick="setTab('agro')" id="tab-agro" class="cat-item flex flex-col items-center p-3 rounded-3xl bg-white shadow-sm border">
                <img src="https://cdn-icons-png.flaticon.com/128/1887/1887043.png" class="w-7 h-7 mb-1">
                <span class="text-[9px] font-bold trans" data-ha="NOMA" data-en="AGRO">NOMA</span>
            </div>
            <div onclick="setTab('services')" id="tab-services" class="cat-item flex flex-col items-center p-3 rounded-3xl bg-white shadow-sm border">
                <img src="https://cdn-icons-png.flaticon.com/128/1067/1067561.png" class="w-7 h-7 mb-1">
                <span class="text-[9px] font-bold trans" data-ha="AIYUKA" data-en="SERVICES">AIYUKA</span>
            </div>
        </div>

        <main class="px-4 grid grid-cols-2 gap-4" id="item-grid"></main>

        <div class="p-10 text-center">
            <button onclick="togglePrivacy(true)" class="text-[10px] text-gray-400 underline uppercase font-bold trans" data-ha="Ka'idojin Sirri" data-en="Privacy Policy">Ka'idojin Sirri</button>
        </div>
    </div>

    <div id="admin-view" class="hidden p-6 animate-fade-in">
        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border space-y-4 mb-8">
            <h3 class="font-black text-emerald-900 text-xs uppercase">New Item</h3>
            <input id="in-name" placeholder="Sunan Kaya" class="w-full p-4 bg-gray-50 rounded-2xl border outline-none text-sm">
            <input id="in-price" type="number" placeholder="Farashi (Pi)" class="w-full p-4 bg-gray-50 rounded-2xl border outline-none text-sm">
            <select id="in-cat" class="w-full p-4 bg-gray-50 rounded-2xl font-bold text-sm">
                <option value="tech">Tech</option><option value="fashion">Fashion</option>
                <option value="agro">Agro</option><option value="services">Services</option>
            </select>
            <input id="in-img" placeholder="Manna Direct Link (Postimg)" class="w-full p-4 bg-gray-50 rounded-2xl border outline-none text-sm">
            <button onclick="publish()" class="w-full pi-gradient text-white py-4 rounded-2xl font-black shadow-lg">LODA KAYA</button>
        </div>
        <div id="manage-list" class="space-y-3 bg-white p-4 rounded-3xl border mb-20"></div>
        <button onclick="closeAdmin()" class="w-full py-4 text-gray-400 font-bold text-[10px] uppercase">Back</button>
    </div>

    <div id="privacy-modal" class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 text-center">
        <div class="bg-white w-full max-h-[70vh] rounded-[3rem] p-8 relative overflow-y-auto">
            <h2 class="font-black text-emerald-900 mb-4 uppercase text-sm">Privacy Policy</h2>
            <div class="text-[11px] text-gray-500 space-y-4">
                <p>Arewa-mart Hub developed by @Bashful97. We only use Pi username for order processing. No wallet passphrases are ever requested.</p>
            </div>
            <button onclick="togglePrivacy(false)" class="w-full pi-gradient text-white py-4 rounded-2xl font-black mt-8">OK</button>
        </div>
    </div>

    <nav class="fixed bottom-6 left-10 right-10 h-16 glass-nav border rounded-full flex justify-around items-center shadow-2xl z-50">
        <button onclick="closeAdmin()" class="text-2xl">üè†</button>
        <button onclick="openAdmin()" class="text-2xl">‚öôÔ∏è</button>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAWJMF1tg5XoTtWAqZVeKdmNgufl-PFt3E",
            authDomain: "arewa-mart-1663d.firebaseapp.com",
            projectId: "arewa-mart-1663d",
            appId: "1:782392811138:web:ac528c22d93caf7a239e9b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- GYARAR PI SDK ---
        const Pi = window.Pi;
        async function initPi() {
            try {
                // 1. AN CANJA SANDBOX ZUWA FALSE DON MAINNET CHECKLIST
                Pi.init({ version: "2.0", sandbox: false });
                
                // 2. AUTHENTICATION DON TABBATAR DA CEWA KANA CIKIN BROWSER
                await Pi.authenticate(['username', 'payments'], (onIncomplete) => {
                    console.log("Incomplete Payment: ", onIncomplete);
                });
                console.log("Pi SDK Initialized Successfully");
            } catch (e) { 
                console.error("SDK Error: Tabbatar kana cikin Pi Browser."); 
            }
        }

        let lang = 'ha'; let filter = 'all';

        function changeLang() {
            lang = (lang === 'ha') ? 'en' : 'ha';
            document.getElementById('lang-btn').innerText = (lang === 'ha') ? 'ENGLISH' : 'HAUSA';
            document.querySelectorAll('.trans').forEach(el => el.innerText = el.getAttribute('data-' + lang));
            render();
        }

        function setTab(t) {
            filter = t;
            document.querySelectorAll('.cat-item').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-' + t).classList.add('active');
            render();
        }

        async function publish() {
            const name = document.getElementById('in-name').value;
            const price = document.getElementById('in-price').value;
            const cat = document.getElementById('in-cat').value;
            const img = document.getElementById('in-img').value;
            if(!name || !price || !img) return alert("Cike komai!");
            await db.collection("products").add({ name, price: parseFloat(price), category: cat, url: img, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            alert("An adana!");
            closeAdmin();
        }

        async function handlePayment(itemName, itemPrice) {
            try {
                const paymentData = {
                    amount: parseFloat(itemPrice),
                    memo: "Siyan " + itemName + " a Arewa-mart Hub",
                    metadata: { productName: itemName }
                };
                const callbacks = {
                    onReadyForServerApproval: (id) => { console.log("Approved", id); },
                    onReadyForServerCompletion: (id, txid) => { alert("Nasara! Transaction ID: " + txid); },
                    onCancel: (id) => { alert("An fasa biya."); },
                    onError: (e, p) => { alert("Error: " + e.message); }
                };
                await Pi.createPayment(paymentData, callbacks);
            } catch (err) {
                alert("Kuskure ya faru wurin biya.");
            }
        }

        function render() {
            const grid = document.getElementById('item-grid');
            const manage = document.getElementById('manage-list');
            db.collection("products").orderBy("createdAt", "desc").onSnapshot(snap => {
                grid.innerHTML = ''; manage.innerHTML = '';
                snap.forEach(doc => {
                    const p = doc.data();
                    if(filter === 'all' || p.category === filter) {
                        grid.innerHTML += `
                        <div class="bg-white p-2 rounded-[2.5rem] border border-gray-100 shadow-sm animate-fade-in">
                            <img src="${p.url}" class="h-36 w-full object-cover rounded-[2rem] mb-2" onerror="this.src='https://i.postimg.cc/qRqMd44D/unnamed-5-1.jpg'">
                            <div class="px-3 pb-1 text-center">
                                <h4 class="text-[10px] font-black uppercase truncate text-emerald-950">${p.name}</h4>
                                <p class="text-emerald-600 font-extrabold text-xs mb-3">${p.price} Pi</p>
                                <button onclick="handlePayment('${p.name}', ${p.price})" class="w-full pi-gradient text-white py-2.5 rounded-2xl text-[9px] font-black uppercase shadow-md">
                                    ${lang === 'ha' ? 'SAYE' : 'BUY'}
                                </button>
                            </div>
                        </div>`;
                    }
                    manage.innerHTML += `<div class="flex justify-between p-3 border-b text-[10px] font-bold"><span>${p.name}</span><button onclick="del('${doc.id}')" class="text-red-500 font-black">GOGE</button></div>`;
                });
            });
        }

        function togglePrivacy(s) { document.getElementById('privacy-modal').classList.toggle('hidden', !s); }
        function openAdmin() { if(prompt("Password:") === "Zuhafs9700") { document.getElementById('main-view').classList.add('hidden'); document.getElementById('admin-view').classList.remove('hidden'); } }
        function closeAdmin() { document.getElementById('main-view').classList.remove('hidden'); document.getElementById('admin-view').classList.add('hidden'); }
        async function del(id) { if(confirm("Goge wannan kaya?")) await db.collection("products").doc(id).delete(); }

        // 3. YIN AMFANI DA DOMCONTENTLOADED MAIMAKON WINDOW.ONLOAD
        document.addEventListener("DOMContentLoaded", function() {
            initPi();
            render();
        });
    </script>
</body>
</html>